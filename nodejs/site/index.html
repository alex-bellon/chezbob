<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      window.global = window;
    </script>
  </head>

  <body>
    <div id="terminal"></div>
    <script type="module">
      import { ReconnectingSocket } from "./common/reconnecting-socket.js";
      //#Source https://bit.ly/2neWfJ2
      const uuid = () =>
        ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>
          (
            c ^
            (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
          ).toString(16)
        );

      let socket = await ReconnectingSocket.connect("pos");
      socket.on("scan_event", async (msg) => {
        let resp = await socket.request({
          header: {
            to: "/inventory",
            id: uuid(),
            type: "info_req",
          },
          body: {
            barcode: msg.body.barcode,
          },
        });

        document.body.innerHTML = `<div id='price-check'>Price Check</div>
                    <div id='name'>${resp.body.name}</div>
                    <div id='price'> ${Math.floor(resp.body.cents / 100)}.${
          resp.body.cents % 100
        }</div>
                </div>`;
      });
    </script>
  </body>
</html>
